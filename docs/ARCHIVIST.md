# Archivist Bot

The Archivist is a built-in bot that creates nightly markdown summaries of chat activity. It uses deterministic extractive summarization - no AI or LLM is involved.

## Overview

- **Automatic Archiving**: Runs nightly at a configurable time (default: 22:00)
- **Extractive Summary**: Uses TF-IDF-like scoring to identify key sentences
- **Output**: Markdown files saved to Hall Chest `archives/` folder
- **Catch-up**: If the app was offline during scheduled time, runs on next connect

## Commands

All commands are typed in the chat input. They are intercepted and processed by the Archivist.

| Command | Description |
|---------|-------------|
| `/archive-now` | Run archive immediately |
| `/archive-status` | Show current configuration |
| `/archive-enable` | Enable automatic archiving |
| `/archive-disable` | Disable automatic archiving |
| `/set-archive-time HHMM` | Set archive time (e.g., `2200` for 10 PM) |
| `/set-archive-window 12h\|24h` | Set time window to summarize |
| `/set-archive-output chest\|chest:username` | Set output location |

### Examples

```
/archive-enable
/set-archive-time 0300
/set-archive-window 24h
/archive-now
```

## Configuration

Per-hall configuration is stored in SQLite. Default values:

| Setting | Default | Description |
|---------|---------|-------------|
| `enabled` | `false` | Archiving disabled by default |
| `archive_time` | `2200` | 10:00 PM local time |
| `archive_window` | `24h` | Last 24 hours of messages |
| `archive_output` | `chest` | Write to `archives/ARCHIVE_YYYY-MM-DD.md` |

## Output Format

The archive is a markdown file with these sections:

1. **Header**: Hall name and time period
2. **Activity Summary**: Total messages, unique participants, top contributors
3. **Highlights**: Top-scoring sentences (extractive summary)
4. **Open Questions**: Lines ending with `?`
5. **Decisions and Action Items**: Lines containing keywords like "let's", "decided", "todo", "ship"

### Example Output

```markdown
# Archive: Project Hall

**Period:** 2024-01-15 00:00 UTC to 2024-01-15 22:00 UTC

## Activity Summary

- **Total messages:** 47
- **Unique participants:** 4
- **Top contributors:**
  - alice: 18 messages
  - bob: 15 messages
  - carol: 10 messages

## Highlights

- **alice:** The new architecture handles concurrency much better.
- **bob:** We need to prioritize the database migration before release.

## Open Questions

- **carol:** Should we use async or sync for the file operations?

## Decisions and Action Items

- **alice:** Let's ship the MVP by Friday.
- **bob:** TODO: Update the documentation before merge.

---
*Generated by Archivist at 2024-01-15 22:00 UTC*
```

## Technical Details

### Extractive Summarization

The Archivist uses a simple TF-IDF-like algorithm:

1. Split messages into sentences
2. Tokenize each sentence (lowercase, filter short words)
3. Calculate term frequency per sentence
4. Calculate inverse document frequency across all sentences
5. Score each sentence: `TF Ã— IDF / sqrt(length)`
6. Boost sentences containing "important", "key", "note"
7. Select top N sentences as highlights

### Scheduling

- Timer runs every 60 seconds to check if it's archive time
- Deduplication prevents multiple runs in the same minute
- On connect, checks if more than 25 hours since last run (catch-up)

### File Storage

Archives are written to the Hall Chest:
- Default: `archives/ARCHIVE_YYYY-MM-DD.md`
- With username: `archives/{username}/ARCHIVE_YYYY-MM-DD.md`

The Hall Chest is located at:
- Linux: `~/.local/share/exom/chests/{hall_id}/`
- macOS: `~/Library/Application Support/dev.onyx.exom/chests/{hall_id}/`
