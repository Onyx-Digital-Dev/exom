// Left panel - Hall selector

import { Theme } from "theme.slint";
import { TextInput, Button, ListItem, RoleBadge, ErrorText, Separator } from "components.slint";

// Hall list item data
export struct HallItem {
    id: string,
    name: string,
    role: string,
}

export component HallsPanel inherits Rectangle {
    in property <[HallItem]> halls;
    in property <string> current-hall-id;
    in property <string> error-text;

    callback select-hall(string);
    callback create-hall(string);
    callback join-with-invite(string);

    background: Theme.surface;
    width: Theme.left-panel-width;

    VerticalLayout {
        // Header
        Rectangle {
            height: 48px;
            background: Theme.surface;

            HorizontalLayout {
                padding-left: Theme.spacing-md;
                padding-right: Theme.spacing-md;
                alignment: space-between;

                Text {
                    text: "Halls";
                    color: Theme.text-primary;
                    font-size: Theme.font-lg;
                    font-weight: 500;
                    vertical-alignment: center;
                }
            }
        }

        Separator {}

        // Hall list
        Flickable {
            vertical-stretch: 1;

            VerticalLayout {
                padding: Theme.spacing-sm;
                spacing: 2px;

                for hall in root.halls: ListItem {
                    selected: hall.id == root.current-hall-id;

                    clicked => { root.select-hall(hall.id); }

                    HorizontalLayout {
                        padding-left: Theme.spacing-sm;
                        padding-right: Theme.spacing-sm;
                        spacing: Theme.spacing-sm;

                        Text {
                            text: hall.name;
                            color: Theme.text-primary;
                            font-size: Theme.font-md;
                            vertical-alignment: center;
                            horizontal-stretch: 1;
                            overflow: elide;
                        }

                        RoleBadge {
                            role: hall.role;
                        }
                    }
                }
            }
        }

        Separator {}

        // Create/Join section
        Rectangle {
            height: 120px;
            background: Theme.surface;

            VerticalLayout {
                padding: Theme.spacing-sm;
                spacing: Theme.spacing-sm;

                new-hall-input := TextInput {
                    placeholder: "New hall name";
                    accepted => { root.create-hall(self.text); self.text = ""; }
                }

                Button {
                    label: "Create Hall";
                    clicked => { root.create-hall(new-hall-input.text); new-hall-input.text = ""; }
                }

                invite-input := TextInput {
                    placeholder: "Invite code";
                    accepted => { root.join-with-invite(self.text); self.text = ""; }
                }

                Button {
                    label: "Join with Invite";
                    clicked => { root.join-with-invite(invite-input.text); invite-input.text = ""; }
                }

                ErrorText {
                    text: root.error-text;
                }
            }
        }
    }
}
