// Left panel - Hall selector

import { Theme } from "theme.slint";
import { TextField, Button, ListItem, RoleBadge, ErrorText, Separator, EmptyState } from "components.slint";

// Hall list item data
export struct HallItem {
    id: string,
    name: string,
    role: string,
}

export component HallsPanel inherits Rectangle {
    in property <[HallItem]> halls;
    in property <string> current-hall-id;
    in property <string> error-text;

    callback select-hall(string);
    callback create-hall(string);
    callback join-with-invite(string);

    background: Theme.color-panel;
    width: Theme.left-panel-width;

    VerticalLayout {
        // Header
        Rectangle {
            height: 48px;
            background: Theme.color-panel;

            HorizontalLayout {
                padding-left: Theme.pad-md;
                padding-right: Theme.pad-md;
                alignment: space-between;

                Text {
                    text: "Halls";
                    color: Theme.color-text;
                    font-size: Theme.text-lg;
                    font-weight: 500;
                    vertical-alignment: center;
                }
            }
        }

        Separator {}

        // Hall list
        Flickable {
            vertical-stretch: 1;

            VerticalLayout {
                padding: Theme.pad-sm;
                spacing: 2px;

                // Empty state when no halls
                if root.halls.length == 0: EmptyState {
                    title: "No Halls";
                    description: "Create a hall or join one with an invite code.";
                    height: 120px;
                }

                for hall in root.halls: ListItem {
                    selected: hall.id == root.current-hall-id;

                    clicked => { root.select-hall(hall.id); }

                    HorizontalLayout {
                        padding-left: Theme.pad-sm;
                        padding-right: Theme.pad-sm;
                        spacing: Theme.pad-sm;

                        Text {
                            text: hall.name;
                            color: Theme.color-text;
                            font-size: Theme.text-md;
                            vertical-alignment: center;
                            horizontal-stretch: 1;
                            overflow: elide;
                        }

                        RoleBadge {
                            role: hall.role;
                            subtle: true;
                        }
                    }
                }
            }
        }

        Separator {}

        // Create/Join section
        Rectangle {
            height: 140px;
            background: Theme.color-panel;

            VerticalLayout {
                padding: Theme.pad-sm;
                spacing: Theme.pad-sm;

                new-hall-input := TextField {
                    placeholder: "New hall name";
                    accepted => {
                        if self.text != "" {
                            root.create-hall(self.text);
                            self.clear();
                        }
                    }
                }

                Button {
                    label: "Create Hall";
                    clicked => {
                        if new-hall-input.text != "" {
                            root.create-hall(new-hall-input.text);
                            new-hall-input.clear();
                        }
                    }
                }

                invite-input := TextField {
                    placeholder: "Invite code";
                    accepted => {
                        if self.text != "" {
                            root.join-with-invite(self.text);
                            self.clear();
                        }
                    }
                }

                Button {
                    label: "Join with Invite";
                    clicked => {
                        if invite-input.text != "" {
                            root.join-with-invite(invite-input.text);
                            invite-input.clear();
                        }
                    }
                }

                ErrorText {
                    text: root.error-text;
                }
            }
        }
    }
}
